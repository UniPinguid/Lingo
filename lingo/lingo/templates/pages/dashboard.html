<!DOCTYPE html>

<html>

<head>
    <link href="static/css/dashboard.css" rel="stylesheet" />
    <link href="static/css/components/button.css" rel="stylesheet" />
    <link href="static/css/components/format.css" rel="stylesheet" />
    <link href="static/css/components/popup.css" rel="stylesheet" />
    <link href="static/css/components/radio.css" rel="stylesheet" />
    <link href="static/css/components/suggestion.css" rel="stylesheet" />
    <link href="static/css/components/logo.css" rel="stylesheet" />
    <link href="static/css/icon.css" rel="stylesheet" />
    <link href="static/css/root.css" rel="stylesheet" />
    <title>Dashboard | LingoLab</title>
    {% load static %}
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
</head>

<body>
    <div class="page-layout">
        <div class="sidebar">
            <div style="padding: 8px;"><div class="logo" id="lab" ></div></div>
            <button class="button" id="popupButton">
                <div class="icon white size40px" id="plus"></div>Create Project
            </button>
            <div class="collapsible">
                My Project
                <button class="toggle">
                    <div class="icon" id="expand"></div>
                </button>
            </div>
            <div class="content">
                <div class="group-items">
                    {% for project in projects %}
                        <div class="item">
                            <div class="project-color"></div>
                            <a class="project-name" href="{% url 'project' project.id_project %}"> {{ project.projectname }}</a>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="collapsible">
                Toolbox
                <button class="toggle">
                    <div class="icon" id="expand"></div>
                </button>
            </div>
            <div class="content">
                <div class="group-items">
                    <div class="item">
                        <div class="icon light" id="categorization"></div>
                        <a class="project-name" href="#">Categorization</a>
                    </div>
                    <div class="item">
                        <div class="icon light" id="qa"></div>
                        <a class="project-name" href="#">Questions & Answers</a>
                    </div>
                    <div class="item">
                        <div class="icon light" id="translation"></div>
                        <a class="project-name" href="#">Translation</a>
                    </div>
                    <div class="item">
                        <div class="icon light" id="equivalency"></div>
                        <a class="project-name" href="#">Equivalency</a>
                    </div>
                </div>
            </div>
            <hr />
            <div class="group-items">
                <div class="item">
                    <div class="icon light" id="moon"></div>
                    <a class="project-name" href="#">Dark Mode</a>
                </div>
                <div class="item">
                    <div class="icon light" id="cog"></div>
                    <a class="project-name" href="#">Settings</a>
                </div>
                <div class="item">
                    <div class="icon light" id="logout"></div>
                    <a class="project-name" href="{% url '' %}">Log Out</a>
                </div>
            </div>
        </div>
        <div class="page-content">
            <div class="header">
                <div class="pagename">Dashboard</div>
                <div class="functions">
                    <div class="search-bar">
                        <input class="search" placeholder="Search">
                        <div class="icon" id="search"></div>
                    </div>
                    <div class="icon" id="globe"></div>
                    <div class="icon" id="bell"></div>
                    <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                </div>
            </div>
            <div class="container">
                <div class="left-section">
                    <h1>My Work</h1>
                    <div class="graph-container">
                        <div class="graph">
                            <h2>My Projects</h2>
                            <div style="display: flex;flex-direction: row; gap: 16px">
                                <div class="stat" style="color: var(--primary)">4</div>
                                <div class="change">+2<br>last month</div>
                            </div>
                            <div class="chart"><img src="{{STATIC_URL}}images/chart 1.svg" style="width: 100%;"></div>
                        </div>
                        <div class="graph">
                            <h2>Community Projects</h2>
                            <div style="display: flex;flex-direction: row; gap: 16px">
                                <div class="stat" style="color: var(--accent-purple)">4</div>
                                <div class="change">+2<br>last month</div>
                            </div>
                            <div class="chart"><img src="{{STATIC_URL}}images/chart 2.svg"  style="width: 100%;"></div>
                        </div>
                        <div class="graph">
                            <h2>Total Score</h2>
                            <div style="display: flex;flex-direction: row; gap: 16px">
                                <div class="stat" style="color: var(--complete)">424</div>
                                <div class="change">+242<br>today</div>
                            </div>
                            <div class="chart"><img src="{{STATIC_URL}}images/chart 3.svg"  style="width: 100%;"></div>
                        </div>
                    </div>
                    <h1>Activity</h1>
                    <div class="activity-container">
                        <h2>April 20th, 2023</h2>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>

                        <h2>April 19th, 2023</h2>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>
                        <div class="activity">
                            <div class="icon" id="label"></div>
                            <div class="time">8:45</div>
                            <div class="instance">You invited pstung, nhkhoi, ltngan to Novelty Accuracy as a
                                contributor.</div>
                        </div>
                    </div>
                </div>
                <div class="right-section">
                    <h1>Today</h1>
                    <h2>
                        <script src="static/js/date.js"></script>
                    </h2>
                    <div class="calendar">
                        <div class="month">
                            <button id="prev">
                                <div class="icon light" id="arrow-left"></div>
                            </button>
                            <div id="month-year">April 2023</div>
                            <button id="next">
                                <div class="icon light" id="arrow-right"></div>
                            </button>
                        </div>
                        <div class="days">
                            <div>Mon</div>
                            <div>Tue</div>
                            <div>Wed</div>
                            <div>Thu</div>
                            <div>Fri</div>
                            <div>Sat</div>
                            <div>Sun</div>
                        </div>
                        <div class="dates" id="dates">
                            <script src="static/js/calendar.js"></script>
                        </div>
                    </div>
                    <div class="task-deadline">
                        <h3>Upcoming Task Deadline</h3>
                        <div class="deadline">
                            <div class="icon" id="task"></div>
                            <div class="content">Task <a class="task" href="#">Label Animal Species</a> on <a
                                    class="project" href="#">Pokémon Species Recognition</a> needs to be done before
                                07:24.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <h1>Recent Projects</h1>
            <div class="projects-container">
                {% for project in projects %}
                <div class="project">
                    <div class="header">
                        <div class="title">
                            <a class="name" href="{% url 'project' project.id_project  %}">{{ project.projectname }}</a>
                            <div class="category">{{ project.tags }}</div>
                        </div>
                        <div class="participants">
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                        </div>
                    </div>
                    <div class="description">
                        {{ project.description }}
                    </div>
                    <hr>
                    <div class="stats">
                        <div class="tasks">
                            <div class="icon light" id="task-complete"></div>4/27
                        </div>
                        <div class="time">1 day ago</div>
                    </div>
                </div>
                
                {% endfor %}
            </div>
            <br>
            <h1>Tasks</h1>
            <div class="tasks-stats">
                <div class="stat-card">
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
                        <div class="icon light" id="task"></div>
                        <div class="stat-name">Pending Tasks</div>
                    </div>
                    <div class="num-box">22</div>
                </div>
                <div class="stat-card">
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
                        <div class="icon light" id="task"></div>
                        <div class="stat-name">On-Going Tasks</div>
                    </div>
                    <div class="num-box" style="background-color: var(--fill-primary); color: var(--primary)">12</div>
                </div>
                <div class="stat-card">
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 8px;">
                        <div class="icon light" id="task-complete"></div>
                        <div class="stat-name">Completed Tasks</div>
                    </div>
                    <div class="num-box" style="background-color: var(--accent-background-green); color: var(--accent-green)">7</div>
                </div>
            </div>
            <div class="tasks-container">
                <div class="task">
                    <div class="header">
                        <div class="title">
                            <a class="project-name" href="#">Neural Activation</a>
                            <div>/</div>
                            <div style="display: flex; align-items: center">
                                <div class="icon" id="task"></div>
                                <a class="task-name" href="#">#PMD-123925</a>
                            </div>
                        </div>
                        <div class="icon light" id="more-horizontal"></div>
                    </div>
                    <div style="margin-top: -8px;">
                        <hr>
                    </div>
                    <div class="category">Text Classification</div>
                    <div class="description">Aims to categorize paragraphs based on their content and context.</div>
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
                        <div class="progress-bar">
                            <div class="current" style="width:60%"></div>
                        </div>
                        <div>60%</div>
                    </div>
                    <div style="display: flex; flex-direction: row; justify-content: space-between;">
                        <div style="display: flex; flex-direction: row; gap: 24px;">
                            <div class="stat">
                                <div class="icon" id="search"></div>12
                            </div>
                            <div class="stat">
                                <div class="icon" id="search"></div>24
                            </div>
                        </div>
                        <div class="participants">
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                        </div>
                    </div>
                </div>
                <div class="task">
                    <div class="header">
                        <div class="title">
                            <a class="project-name" href="#">Neural Activation</a>
                            <div>/</div>
                            <div style="display: flex; align-items: center">
                                <div class="icon" id="task"></div>
                                <a class="task-name" href="#">#PMD-123925</a>
                            </div>
                        </div>
                        <div class="icon light" id="more-horizontal"></div>
                    </div>
                    <div style="margin-top: -8px;">
                        <hr>
                    </div>
                    <div class="category" id="purple">Text Generation</div>
                    <div class="description">Aims to categorize paragraphs based on their content and context.</div>
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
                        <div class="progress-bar">
                            <div class="current" style="width:60%"></div>
                        </div>
                        <div>60%</div>
                    </div>
                    <div style="display: flex; flex-direction: row; justify-content: space-between;">
                        <div style="display: flex; flex-direction: row; gap: 24px;">
                            <div class="stat">
                                <div class="icon" id="search"></div>12
                            </div>
                            <div class="stat">
                                <div class="icon" id="search"></div>24
                            </div>
                        </div>
                        <div class="participants">
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                        </div>
                    </div>
                </div>
                <div class="task">
                    <div class="header">
                        <div class="title">
                            <a class="project-name" href="#">Neural Activation</a>
                            <div>/</div>
                            <div style="display: flex; align-items: center">
                                <div class="icon" id="task"></div>
                                <a class="task-name" href="#">#PMD-123925</a>
                            </div>
                        </div>
                        <div class="icon light" id="more-horizontal"></div>
                    </div>
                    <div style="margin-top: -8px;">
                        <hr>
                    </div>
                    <div class="category">Text Classification</div>
                    <div class="description">Aims to categorize paragraphs based on their content and context.</div>
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
                        <div class="progress-bar">
                            <div class="current" style="width:60%"></div>
                        </div>
                        <div>60%</div>
                    </div>
                    <div style="display: flex; flex-direction: row; justify-content: space-between;">
                        <div style="display: flex; flex-direction: row; gap: 24px;">
                            <div class="stat">
                                <div class="icon" id="search"></div>12
                            </div>
                            <div class="stat">
                                <div class="icon" id="search"></div>24
                            </div>
                        </div>
                        <div class="participants">
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                        </div>
                    </div>
                </div>
                <div class="task">
                    <div class="header">
                        <div class="title">
                            <a class="project-name" href="#">Neural Activation</a>
                            <div>/</div>
                            <div style="display: flex; align-items: center">
                                <div class="icon" id="task"></div>
                                <a class="task-name" href="#">#PMD-123925</a>
                            </div>
                        </div>
                        <div class="icon light" id="more-horizontal"></div>
                    </div>
                    <div style="margin-top: -8px;">
                        <hr>
                    </div>
                    <div class="category">Text Classification</div>
                    <div class="description">Aims to categorize paragraphs based on their content and context.</div>
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
                        <div class="progress-bar">
                            <div class="current" style="width:60%"></div>
                        </div>
                        <div>60%</div>
                    </div>
                    <div style="display: flex; flex-direction: row; justify-content: space-between;">
                        <div style="display: flex; flex-direction: row; gap: 24px;">
                            <div class="stat">
                                <div class="icon" id="search"></div>12
                            </div>
                            <div class="stat">
                                <div class="icon" id="search"></div>24
                            </div>
                        </div>
                        <div class="participants">
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                            <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <hr>
                <div class="info">
                    <div>@ 2023 LingoTeam. All rights reserved.</div>
                    <div class="links">
                        <a href="#">Support</a>
                        <a href="#">Privacy</a>
                        <a href="#">Contact Us</a>
                        <a href="#">About</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="popup">
        <div class="pheader">
            <div class="title">Create a new project</div>
            <button id="closeButton">
                <div class="icon size48px" id="close"></div>
            </button>
        </div>
        <hr>
        <form id="fm-create-project" method="POST" action="{% url 'create_project' %}">{% csrf_token %}</form>
        <div style="display: flex; flex-direction: row; gap: 32px;">
            <!-- Left -->
            <div style="display: flex; flex-direction: column; width: 100%;">
                <h1>Basic Info</h1>
                <label>Project Name</label>
                <input name="project-name" form="fm-create-project" class="input-field" type="text" placeholder="e.g. Specifying Formal Languages">

                <label>Tags</label>
                <input class="input-field" type="text" name="project-tag" form="fm-create-project">

                <label>Description</label>
                <textarea class="input-field" type="text" style="height: 60px;" name="project-description" form="fm-create-project"></textarea>

                <label>Color</label>
                <div>
                    <button class="color"></button>
                </div>
            </div>
            <!-- Right -->
            <div style="display: flex; flex-direction: column; width: 100%;">
                <h1>Visibility</h1>
                <label class="radio">
                    <input type="radio" name="visibility" value="Private" form="fm-create-project">
                    <div class="visibility">
                        <div>
                            <div class="name">Private</div>
                            <div class="description">This project is only be visible to assigned users.</div>
                        </div>
                    </div>
                </label>
                <label class="radio">
                    <input type="radio" name="visibility" value="Protected" form="fm-create-project">
                    <div class="visibility">
                        <div>
                            <div class="name">Protected</div>
                            <div class="description">This project is only accessible via shared links and invitation.</div>
                        </div>
                    </div>
                </label>
                <label class="radio">
                    <input type="radio" name="visibility" value="Public" form="fm-create-project">
                    <div class="visibility">
                        <div>
                            <div class="name">Public</div>
                            <div class="description">This project can be seen by any users.</div>
                        </div>
                    </div>
                </label>
                <label>Assign Members</label>
                <div style="display: flex; flex-direction: row; align-items: center; gap: 16px; position: relative; width: 100%;">
                    <input class="input-field" id="member-bar" style="width: 80%; margin: 4px 0px;" type="text" name="project-member-list" form="fm-create-project" autocomplete="off">
                    <input class="input-field" id="search-bar" style="width: 80%; margin: 4px 0px;" type="text" name="project-member" form="fm-create-project" autocomplete="off">
                    <div id="suggestionsDropdown" class="dropdown"></div>
                    <button class="button-small" id="add-button">Add</button>
                </div>
                <div class="participants" style="margin: 8px 0px 0px 8px;">
                    <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                    <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                    <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                    <div class="avatar"><img src="{{STATIC_URL}}images/sample avatar.png"></div>
                </div>
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  // Get the CSRF token from the HTML template
  var csrfToken = $('[name="csrfmiddlewaretoken"]').val();
  var projectMemberList = [];  // List to store project members

  $('#add-button').on('click', function() {
    var projectMember = $('#search-bar').val();
    if (projectMember.trim() !== '') {
      var currentMembers = $('#member-bar').val();
      var updatedMembers = currentMembers ? currentMembers + ', ' + projectMember : projectMember;
      $('#member-bar').val(updatedMembers);
      $('#search-bar').val('');
    }
  });
  $('#search-bar').on('input', function() {
    var inputText = $(this).val();
    if (inputText.length >= 3) {  // Send request only if the input has at least 3 characters
      $.ajax({
        url: '/get_matching_usernames/',
        method: 'POST',
        data: {
          'search_text': inputText
        },
        headers: {
          'X-CSRFToken': csrfToken  // Include the CSRF token in the request headers
        },
        success: function(response) {
          var dropdown = $('#suggestionsDropdown');
          dropdown.empty();  // Clear previous suggestions

          if (response.length > 0) {
            // Add each suggestion as a list item to the dropdown
            $.each(response, function(index, item) {
              dropdown.append('<div class="dropdown-item">' + item + '</div>');
            });

            // Show the dropdown
            dropdown.show();
          } else {
            // Hide the dropdown if no suggestions found
            dropdown.hide();
          }
        }
      });
    } else {
      $('#suggestionsDropdown').hide();
    }
  });

  // Handle the selection from the dropdown
  $(document).on('click', '.dropdown-item', function() {
    var selectedUsername = $(this).text();
    $('#search-bar').val(selectedUsername);
    $('#suggestionsDropdown').hide();
  });
});
</script>
            </div>
        </div>
        <div class="action-buttons">
            <button class="button" id="ghost">Cancel</button>
            <button class="button" type="submit" form="fm-create-project">Done</button>
            
        </div>
    </div>
    <script src="static/js/collapsible.js"></script>
    <script src="static/js/popup.js"></script>
    <script src="static/js/suggestion.js"></script>
    <script type="text/javascript">
        document.getElementById("fm-create-project").addEventListener("submit", function(event) {
        event.preventDefault(); // Ngăn chặn gửi form

    // Lấy dữ liệu từ form
        var formData = new FormData(this);

    // Gửi dữ liệu bằng Ajax
        fetch(this.action, {
        method: "POST",
        body: formData
        })
        .then(function(response) {
            if (!response.ok) {
            throw new Error("Lỗi: " + response.status);
            }

    // Parse JSON response
            return response.json();
        })
        .then(function(data) {
    // Xử lý dữ liệu JSON trả về từ server
        alert(data.message);
        window.location.href = 'dashboard'; // In ra thông báo từ server
        })
        .catch(function(error) {
        console.error("Lỗi:", error);
        });
        });
    </script>
</body>

</html>